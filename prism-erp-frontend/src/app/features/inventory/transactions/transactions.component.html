<!-- transactions.component.html -->
<div class="container mx-auto px-4 py-8">
  <div class="mb-8">
    <h1 class="text-2xl font-bold text-gray-800 mb-6">New Inventory Transaction</h1>

    <div *ngIf="error" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
      {{ error }}
    </div>

    <div *ngIf="success" class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4">
      {{ success }}
    </div>

    <form [formGroup]="transactionForm" (ngSubmit)="submitTransaction()" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
      <div class="mb-4">
        <label class="block text-gray-700 text-sm font-bold mb-2" for="productId">
          Product ID
        </label>
        <input
          class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
          id="productId"
          type="number"
          formControlName="productId"
          placeholder="Enter product ID">
      </div>

      <div class="mb-4">
        <label class="block text-gray-700 text-sm font-bold mb-2" for="type">
          Transaction Type
        </label>
        <select
          class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
          id="type"
          formControlName="type">
          <option value="INBOUND">Inbound</option>
          <option value="OUTBOUND">Outbound</option>
        </select>
      </div>

      <div class="mb-4">
        <label class="block text-gray-700 text-sm font-bold mb-2" for="quantity">
          Quantity
        </label>
        <input
          class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
          id="quantity"
          type="number"
          formControlName="quantity"
          placeholder="Enter quantity">
      </div>

      <div class="mb-4">
        <label class="block text-gray-700 text-sm font-bold mb-2" for="reference">
          Reference
        </label>
        <input
          class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
          id="reference"
          type="text"
          formControlName="reference"
          placeholder="Enter reference number/code">
      </div>

      <div class="mb-6">
        <label class="block text-gray-700 text-sm font-bold mb-2" for="notes">
          Notes
        </label>
        <textarea
          class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
          id="notes"
          formControlName="notes"
          rows="3"
          placeholder="Enter any additional notes"></textarea>
      </div>

      <div class="flex items-center justify-end">
        <button
          type="submit"
          [disabled]="!transactionForm.valid || loading"
          class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline disabled:opacity-50 disabled:cursor-not-allowed">
          {{ loading ? 'Processing...' : 'Create Transaction' }}
        </button>
      </div>
    </form>
  </div>

  <!-- Transaction History Section -->
  <div class="mt-8">
    <h2 class="text-xl font-bold text-gray-800 mb-4">Transaction History</h2>

    <div class="bg-white shadow-md rounded-lg overflow-hidden">
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Product</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Quantity</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Reference</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Notes</th>
          </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
          <tr *ngFor="let transaction of transactions">
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
              {{ transaction.id | date:'medium' }}
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="text-sm font-medium text-gray-900">{{ transaction.productName }}</div>
              <div class="text-sm text-gray-500">ID: {{ transaction.productId }}</div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
                <span [class]="'px-2 inline-flex text-xs leading-5 font-semibold rounded-full ' + getTransactionTypeClass(transaction.type)">
                  {{ transaction.type }}
                </span>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
              {{ transaction.quantity }}
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
              {{ transaction.reference }}
            </td>
            <td class="px-6 py-4 text-sm text-gray-500">
                <span class="truncate block max-w-xs" [title]="transaction.notes">
                  {{ transaction.notes }}
                </span>
            </td>
          </tr>

          <tr *ngIf="transactions.length === 0">
            <td colspan="6" class="px-6 py-4 text-center text-sm text-gray-500">
              No transactions found. Select a product ID and submit a transaction to see the history.
            </td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div *ngIf="loading" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center">
    <div class="bg-white p-4 rounded-lg shadow-lg">
      <p class="text-gray-700">Processing...</p>
    </div>
  </div>
</div>
