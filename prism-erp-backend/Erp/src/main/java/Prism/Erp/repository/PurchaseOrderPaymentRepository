
@Repository
public interface PurchaseOrderPaymentRepository extends JpaRepository<PurchaseOrderPayment, Long> {
    List<PurchaseOrderPayment> findByPurchaseOrderId(Long purchaseOrderId);
    
    @Query("SELECT pop FROM PurchaseOrderPayment pop WHERE pop.status = :status AND pop.dueDate <= :date")
    List<PurchaseOrderPayment> findOverduePayments(
        @Param("status") PaymentStatus status, 
        @Param("date") LocalDate date
    );
    
    @Query("SELECT SUM(pop.amount) FROM PurchaseOrderPayment pop WHERE pop.purchaseOrder.id = :purchaseOrderId AND pop.status = 'PAID'")
    BigDecimal getTotalPaidAmount(@Param("purchaseOrderId") Long purchaseOrderId);
}